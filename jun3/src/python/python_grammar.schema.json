{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Grammar",
  "description": "A grammar definition",
  "type": "object",
  "properties": {
    "rules": {
      "type": "object",
      "description": "A dictionary of rules",
      "additionalProperties": {
        "$ref": "#/definitions/Rule"
      }
    },
    "metas": {
      "type": "object",
      "description": "A dictionary of metadata",
      "additionalProperties": {
        "type": ["string", "null"]
      }
    }
  },
  "definitions": {
    "Rule": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "The name of the rule"
        },
        "type": {
          "type": ["string", "null"],
          "description": "The type of the rule"
        },
        "rhs": {
          "$ref": "#/definitions/Rhs",
          "description": "The right-hand side of the rule"
        },
        "memo": {
          "type": "object",
          "description": "Memoization data"
        },
        "visited": {
          "type": "boolean",
          "description": "Whether the rule has been visited"
        },
        "nullable": {
          "type": "boolean",
          "description": "Whether the rule is nullable"
        },
        "left_recursive": {
          "type": "boolean",
          "description": "Whether the rule is left-recursive"
        },
        "leader": {
          "type": "boolean",
          "description": "Whether the rule is a leader"
        }
      }
    },
    "Rhs": {
      "type": "object",
      "properties": {
        "alts": {
          "type": "array",
          "description": "A list of alternatives",
          "items": {
            "$ref": "#/definitions/Alt"
          }
        },
        "memo": {
          "type": ["array", "null"],
          "description": "Memoization data",
          "items": [
            {
              "type": ["string", "null"]
            },
            {
              "type": "string"
            }
          ]
        }
      }
    },
    "Alt": {
      "type": "object",
      "properties": {
        "items": {
          "type": "array",
          "description": "A list of named items",
          "items": {
            "$ref": "#/definitions/NamedItem"
          }
        },
        "icut": {
          "type": "integer",
          "description": "The cut index"
        },
        "action": {
          "type": ["string", "null"],
          "description": "The action to perform"
        }
      }
    },
    "NamedItem": {
      "type": "object",
      "properties": {
        "name": {
          "type": ["string", "null"],
          "description": "The name of the item"
        },
        "item": {
          "$ref": "#/definitions/Item",
          "description": "The item itself"
        },
        "type": {
          "type": ["string", "null"],
          "description": "The type of the item"
        },
        "nullable": {
          "type": "boolean",
          "description": "Whether the item is nullable"
        }
      }
    },
    "Item": {
      "oneOf": [
        {
          "$ref": "#/definitions/Leaf"
        },
        {
          "$ref": "#/definitions/NameLeaf"
        },
        {
          "$ref": "#/definitions/StringLeaf"
        },
        {
          "$ref": "#/definitions/Group"
        },
        {
          "$ref": "#/definitions/Opt"
        },
        {
          "$ref": "#/definitions/Repeat"
        },
        {
          "$ref": "#/definitions/Repeat0"
        },
        {
          "$ref": "#/definitions/Repeat1"
        },
        {
          "$ref": "#/definitions/Gather"
        },
        {
          "$ref": "#/definitions/Forced"
        },
        {
          "$ref": "#/definitions/Lookahead"
        },
        {
          "$ref": "#/definitions/PositiveLookahead"
        },
        {
          "$ref": "#/definitions/NegativeLookahead"
        },
        {
          "$ref": "#/definitions/Rhs"
        },
        {
          "$ref": "#/definitions/Cut"
        }
      ]
    },
    "Leaf": {
      "type": "object",
      "properties": {
        "value": {
          "type": "string",
          "description": "The value of the leaf"
        }
      }
    },
    "NameLeaf": {
      "allOf": [
        {
          "$ref": "#/definitions/Leaf"
        }
      ]
    },
    "StringLeaf": {
      "allOf": [
        {
          "$ref": "#/definitions/Leaf"
        }
      ]
    },
    "Group": {
      "type": "object",
      "properties": {
        "rhs": {
          "$ref": "#/definitions/Rhs",
          "description": "The right-hand side of the group"
        }
      }
    },
    "Opt": {
      "type": "object",
      "properties": {
        "node": {
          "$ref": "#/definitions/Item",
          "description": "The optional item"
        }
      }
    },
    "Repeat": {
      "type": "object",
      "properties": {
        "node": {
          "$ref": "#/definitions/Plain",
          "description": "The repeated item"
        },
        "memo": {
          "type": ["array", "null"],
          "description": "Memoization data",
          "items": [
            {
              "type": ["string", "null"]
            },
            {
              "type": "string"
            }
          ]
        }
      }
    },
    "Repeat0": {
      "allOf": [
        {
          "$ref": "#/definitions/Repeat"
        }
      ]
    },
    "Repeat1": {
      "allOf": [
        {
          "$ref": "#/definitions/Repeat"
        }
      ]
    },
    "Gather": {
      "allOf": [
        {
          "$ref": "#/definitions/Repeat"
        },
        {
          "properties": {
            "separator": {
              "$ref": "#/definitions/Plain",
              "description": "The separator between items"
            }
          }
        }
      ]
    },
    "Forced": {
      "type": "object",
      "properties": {
        "node": {
          "$ref": "#/definitions/Plain",
          "description": "The forced item"
        }
      }
    },
    "Lookahead": {
      "type": "object",
      "properties": {
        "node": {
          "$ref": "#/definitions/Plain",
          "description": "The lookahead item"
        },
        "sign": {
          "type": "string",
          "description": "The lookahead sign"
        }
      }
    },
    "PositiveLookahead": {
      "allOf": [
        {
          "$ref": "#/definitions/Lookahead"
        },
        {
          "properties": {
            "sign": {
              "const": "&"
            }
          }
        }
      ]
    },
    "NegativeLookahead": {
      "allOf": [
        {
          "$ref": "#/definitions/Lookahead"
        },
        {
          "properties": {
            "sign": {
              "const": "!"
            }
          }
        }
      ]
    },
    "Plain": {
      "oneOf": [
        {
          "$ref": "#/definitions/Leaf"
        },
        {
          "$ref": "#/definitions/NameLeaf"
        },
        {
          "$ref": "#/definitions/StringLeaf"
        },
        {
          "$ref": "#/definitions/Group"
        }
      ]
    },
    "Cut": {
      "type": "object"
    }
  }
}